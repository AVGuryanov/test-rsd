# Тестовое задание на позицию Senior NodeJS Developer в RSD
## Описание проекта
Данный проект представляет собой базовую структуру приложения, которую можно модифицировать любым удобным способом. Основная задача - реализовать API метод для получения рекомендованных песен с учетом определенных критериев.
## Структура базы данных
В проекте используются 4 основные таблицы:
- Artists (Артисты)
- Genres (Жанры)
- Users (Пользователи)
- Songs (Песни)

Схема базы данных определена в файле . `prisma/schema.prisma`
## Внешний сервис рекомендаций
В проекте имитируется работа с внешним сервисом рекомендаций, доступным по эндпоинту:
``` 
api/external-recommendations?user_id=<user_id>
```
Формат ответа
```
[
    {
        "score": 0.4,
        "songId": 1,
    },
    {
        "score": 0.2,
        "songId" 2
    }
]
```
Несмотря на то, что сервис реализован внутри приложения, взаимодействие с ним должно быть организовано как с внешним API.

**----------Примечание--------**

Предполагается, что данный внешний сервис будет пересчитывать скор максимум 1 раз в день, текущая реализация возвращает случайные числа на каждый вызов
## Основная задача
Необходимо реализовать API метод, возвращающий список песен в формате, определенном в `src/types/response.ts#ISong`.
Для простоты можно передавать user_id параметром в реализуемый метод для "идентификации" пользователя
### Логика определения label
Каждая песня в ответе должна иметь метку (label), которая может принимать одно из трех значений:
- **perfect_match**: присваивается, когда выполняются ОБА условия:
    - Жанр песни (Song#genre) присутствует в списке любимых жанров пользователя (User#favoriteGenres)
    - Score рекомендации > 0.6

- **good_match**: присваивается, когда выполняется ОДНО из условий выше
- **null**: присваивается во всех остальных случаях

### Сортировка результатов
Результаты должны быть отсортированы по убыванию score (песни с более высоким score должны быть в начале списка).
## Технический стек
Никаких ограничений, можно перекроить даже этот шаблон, главное показать навыки проектирования в стэке NodeJS

## Дополнительно

### По проекту
- Для удобства написан .env.example и скрипт для старта приложения в scripts/dev-entrypoint.sh, который подставит переменные из .env
- Имеется команда `yarn run seed`, которая заполнит базу
- docker-compose.local.yml файл с postgres:15 и redis:7.2

### Результат работы необходимо отправить обратным письмом с архивом кода, или ссылкой на Git репозиторий

## Комментарии к решению
Не менял исходный код, делал задание в рамках текущей реализации сервиса.
### Внешний сервис рекомендаций
Сделал отдельный модуль для работы с АПИ внешнего сервиса рекомендаций. Обработку условия по обновлению score для песен пользователя
сделал через кэш. Можно управлять EX в redis и получать актуальные данные чаще чтобы score был актуальный, так как в текущей реализации
в кеше могут находиться данные, устаревшие на день (подняли сервис, запросили данные за пару минут до обновления во внещнем сервисе).
Если точно известно время обновления данных во внешнем сервисе - можно получать их в нужное время через cron и держать актуальными,
однако если внешний сервис является совершенно другой системой без доступа, считаю, что лучше чаще актуализировать данные и периодически
обновлять их из-за невозможности гарантировать стабильную работу этого сервиса. В реализации модуля АПИ внещнего сервиса не делал 
усложненное кеширование с различными декораторами функций и тд, так как не известно что в данном сервисе будет еще N-ое число 
эндпоинтов с подобным принципом работы.
### Эндпоинт для получения списка песен с label
В рамках текущей реализации сервиса добавил новый эндпоинт, также добавил директорию controllers для бизнес логики и repo для работы с БД.
Сделал обязательным PORT в .env так как это нужно для запросов к внешнему сервису. Также добавил валидацию параметроов запроса и
сделал простой middleware для проверки результатов валидации. Также добавил swagger для нового эндпоинта